# Story 1.4: Setup LangGraph & BAML

## Status
Draft

## Story
**As a** developer,
**I want** to set up the basic LangGraph and BAML structure in the backend,
**so that** the foundation for the stateful agent is in place.

## Acceptance Criteria
1. LangGraph and BAML are installed in the backend project.
2. A basic LangGraph graph is defined with placeholder nodes representing the agent flow.
3. A basic BAML file is created to define the function signature for check_user_intent.
4. The /api/chat endpoint is wired to be the entry point for this graph.

## Tasks / Subtasks
- [ ] Install LangGraph and BAML dependencies with TypeScript typings (AC: 1)
- [ ] Define initial graph structure in `backend/src/agent/graph.ts` (AC: 2)
  - [ ] Stub nodes for `check_user_intent`, `offer_payment_plan`, `handle_payer`, `handle_no_debt_claim`, `handle_stonewaller`, and `generate_final_link` (AC: 2)
- [ ] Create `backend/src/agent/functions.baml` with `check_user_intent` schema (AC: 3)
  - [ ] Document expected enum outputs to align with LangGraph transitions (AC: 3)
- [ ] Integrate graph entry point into `/api/chat` pipeline (AC: 4)
  - [ ] Replace direct OpenAI call with LangGraph executor (AC: 4)
  - [ ] Ensure persistence and streaming still function through the graph (AC: 4)

## Dev Notes
- Source node list from `docs/PRD.md` LangGraph Agent Flow section; align state names exactly for future implementation work.
- Keep BAML function definitions declarative and version-controlled; future stories will expand schemas for negotiation offers.
- Maintain separation between transport (`/api/chat`) and agent orchestration per `docs/architecture/coding-standards.md` for testability.
- Include TODO comments indicating which stories will flesh out placeholders to help developers follow the implementation sequence.

### Testing
- Add lightweight Jest tests ensuring the graph can instantiate and transition through placeholder nodes without throwing.
- Mock BAML outputs to exercise each path and confirm the executor returns structured responses.
- Regression-test `/api/chat` happy path to verify no regressions in streaming or persistence integrations.

## Change Log
| Date       | Version | Description                 | Author |
| ---------- | ------- | --------------------------- | ------ |
| 2025-09-25 | 0.1     | Initial draft of story 1.4. | Codex  |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

